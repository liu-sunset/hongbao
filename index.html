<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>分组红包系统</title>
    <link rel="stylesheet" href="style.css">
    <script src="./supabase.js"></script>
</head>
<body>

    <div class="container">
        <!-- 首页视图 -->
        <div id="view-home" class="view active">
            <div class="home-header">
                <div class="logo">🧧</div>
                <h1>分组红包</h1>
                <p class="subtitle">加入分组，一起抢红包</p>
            </div>
            
            <div class="home-actions">
                <div class="action-card" onclick="App.handleJoinGroupClick()">
                    <h3>👋 加入分组</h3>
                    <p class="subtitle">输入分组号加入</p>
                </div>
                
                <div class="action-card highlight" onclick="App.handleCreateGroup()">
                    <h3>✨ 创建分组</h3>
                    <p class="subtitle">创建属于你的红包圈子</p>
                    <button id="btnCreate" class="btn-primary" style="margin-top:16px;width:100%;">立即创建</button>
                </div>
            </div>

            <div class="my-groups">
                <div class="section-title">我的分组</div>
                <div id="myGroupsList" class="group-list">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>

        <!-- 分组视图 -->
        <div id="view-group" class="view">
            <div class="nav-bar">
                <div class="nav-back" onclick="window.location.hash='#home'">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                </div>
                <div class="nav-title">分组 <span id="groupCodeDisplay">...</span></div>
                <div class="nav-menu-btn" onclick="App.toggleMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                    <div id="menuDropdown" class="menu-dropdown">
                        <button class="menu-item" onclick="App.handleSendPacketClick()">发红包</button>
                        <button class="menu-item" onclick="App.handleShare()">分享分组</button>
                        <button id="btnDeleteGroup" class="menu-item danger" onclick="App.handleDeleteGroup()">解散分组</button>
                    </div>
                </div>
            </div>

            <div class="group-content">
                <!-- 红包区域 -->
                <div id="packetArea"></div>

                <!-- 成员列表 -->
                <div class="section-title">分组成员</div>
                <div id="membersList" class="members-list">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 弹窗组件 -->
    
    <!-- 加入分组弹窗 -->
    <div id="modalJoin" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">加入分组</h3>
            <div class="form-group">
                <label>分组号 (6位数字)</label>
                <input type="number" id="inputJoinCode" class="form-input" placeholder="例如: 123456">
            </div>
            <div class="form-group">
                <label>您的昵称</label>
                <input type="text" id="inputJoinName" class="form-input" placeholder="例如: 隔壁老王" maxlength="10">
            </div>
            <div class="modal-footer">
                <button class="btn-outline" onclick="App.closeModals()">取消</button>
                <button id="btnJoinConfirm" class="btn-primary" onclick="App.handleJoinSubmit()">加入</button>
            </div>
        </div>
    </div>

    <!-- 发红包弹窗 -->
    <div id="modalSend" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title">发红包</h3>
            <div class="form-group">
                <label>总金额 (元)</label>
                <input type="number" id="inputAmount" class="form-input" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label>红包个数 (最大6个)</label>
                <input type="number" id="inputCount" class="form-input" placeholder="1-6" max="6">
            </div>
            <div class="modal-footer">
                <button class="btn-outline" onclick="App.closeModals()">取消</button>
                <button id="btnSendConfirm" class="btn-primary" onclick="App.handleSendSubmit()">塞进红包</button>
            </div>
        </div>
    </div>

    <!-- 抢红包结果弹窗 -->
    <div id="modalResult" class="modal-overlay" onclick="App.closeModals()">
        <div class="modal-box result-box" onclick="event.stopPropagation()">
            <div class="result-icon">🎉</div>
            <h3 class="modal-title result-title">恭喜发财</h3>
            <div class="result-desc">您抢到了</div>
            <div class="result-amount"><small>¥</small><span id="resultAmount">0.00</span></div>
            <div class="modal-footer">
                <button class="btn-outline" onclick="App.closeModals()">开心收下</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">消息提示</div>

    <!-- Alert 弹窗 -->
    <div id="alertOverlay" class="alert-overlay">
        <div class="alert-box">
            <h3 class="alert-title">提示</h3>
            <p id="alertMessage" class="alert-message"></p>
            <button class="alert-btn" onclick="Utils.closeAlert()">知道了</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
